[(...................................................................................................................)(......................................................................................................)([31mF[m....................................................[31mF[m[31mF[m[31mF[m[31mF[m[31mF[m[31mF[m[31mF[m......................)(...........................................................................................................................................................................)(.............................)(......................................................................)(...........................)(..........................................................................................)(..............................................................................................................................................................................................................................................)(........................................................................................)(..............)(....................................)(........................)(..................................................................................................................................)(.....................................................................................)(........................................................................................................................................)(..............................................................................................................)(................................................................................................................)(.....................................................)(.............................................................................)(....................................................)(..............[31mF[m[31mF[m[31mE[m..........[31mF[m[31mF[m......[31mF[m[31mF[m[31mF[m[31mE[m[31mE[m.....................)(.......................................................................................................................................................................)(.......................)][(.....................................................................................)(......................................)(..................................................................)(..............................................................................................................................................................)(.....................................................................................................................................................................)(.........................................)(...............)(.............................................................................................)]

[31mFAIL[m in mcp-tasks.cli.parse-test/coerce-json-array-test (parse_test.clj:26)
coerce-json-array parses valid JSON array
Expected:
  [1;31m[[0m[1;31m{[0m[1;33m:as-type[0m [1;35m"blocked-by"[0m, [1;33m:id[0m [36m1[0m, [1;33m:relates-to[0m [36m2[0m[1;31m}[0m[1;31m][0m
Actual:
  [31m-[{:as-type "blocked-by", :id 1, :relates-to 2}][0m
  [32m+{:error "Expected JSON array for --relations",
    :provided "[{\"id\":1,\"relates-to\":2,\"as-type\":\"blocked-by\"}]"}[0m

[31mFAIL[m in mcp-tasks.cli.parse-test/parse-update-test (parse_test.clj:244)
parse-update parses relations as JSON
Expected:
  [36m42[0m
Actual:
  [31m-42[0m [32m+nil[0m

[31mFAIL[m in mcp-tasks.cli.parse-test/parse-update-test (parse_test.clj:245)
parse-update parses relations as JSON
expected: (vector? (:relations result))
  actual: (not (vector? nil))

[31mFAIL[m in mcp-tasks.cli.parse-test/parse-update-test (parse_test.clj:246)
parse-update parses relations as JSON
Expected:
  [36m1[0m
Actual:
  [31m-1[0m [32m+0[0m

[31mFAIL[m in mcp-tasks.cli.parse-test/parse-update-test (parse_test.clj:247)
parse-update parses relations as JSON
Expected:
  [1;31m{[0m[1;33m:as-type[0m [1;35m"blocked-by"[0m, [1;33m:id[0m [36m1[0m, [1;33m:relates-to[0m [36m2[0m[1;31m}[0m
Actual:
  [31m-{:as-type "blocked-by", :id 1, :relates-to 2}[0m [32m+nil[0m

[31mFAIL[m in mcp-tasks.cli.parse-test/parse-update-test (parse_test.clj:253)
parse-update parses both meta and relations
Expected:
  [36m42[0m
Actual:
  [31m-42[0m [32m+nil[0m

[31mFAIL[m in mcp-tasks.cli.parse-test/parse-update-test (parse_test.clj:254)
parse-update parses both meta and relations
Expected:
  [1;31m{[0m[1;33m:foo[0m [1;35m"bar"[0m[1;31m}[0m
Actual:
  [31m-{:foo "bar"}[0m [32m+nil[0m

[31mFAIL[m in mcp-tasks.cli.parse-test/parse-update-test (parse_test.clj:255)
parse-update parses both meta and relations
Expected:
  [1;31m[[0m[1;31m{[0m[1;33m:as-type[0m [1;35m"related"[0m, [1;33m:id[0m [36m1[0m, [1;33m:relates-to[0m [36m2[0m[1;31m}[0m[1;31m][0m
Actual:
  [31m-[{:as-type "related", :id 1, :relates-to 2}][0m [32m+nil[0m

[31mFAIL[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-branch-discovery (work_on_worktree_test.clj:333)
work-on discovers existing worktree for branch creates new worktree when branch not in any worktree
Expected:
  [1;35m"/var/folders/pq/q3q7tfqd7x1g567w2xxy67x00000gn/T/mcp-tasks-new-worktree"[0m
Actual:
  [31m-"/var/folders/pq/q3q7tfqd7x1g567w2xxy67x00000gn/T/mcp-tasks-new-worktree"[0m [32m+nil[0m

[31mFAIL[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-branch-discovery (work_on_worktree_test.clj:334)
work-on discovers existing worktree for branch creates new worktree when branch not in any worktree
expected: (true? (:worktree-created? response))
  actual: (not (true? nil))

[31mERROR[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-branch-discovery (string.clj:377)
work-on discovers existing worktree for branch creates new worktree when branch not in any worktree
Exception: java.lang.NullPointerException: Cannot invoke "Object.toString()" because "s" is null
 at clojure.string$includes_QMARK_.invokeStatic (string.clj:377)
    clojure.string$includes_QMARK_.invoke (string.clj:373)
    ...
    mcp_tasks.tool.work_on_worktree_test$fn__25797$fn__25798$fn__25831$fn__25868$fn__25881.invoke (work_on_worktree_test.clj:335)
    mcp_tasks.tool.work_on_worktree_test$fn__25797$fn__25798$fn__25831$fn__25868.invoke (work_on_worktree_test.clj:335)
    ...
    mcp_tasks.tool.work_on_worktree_test$fn__25797$fn__25798$fn__25831.invoke (work_on_worktree_test.clj:289)
    mcp_tasks.tool.work_on_worktree_test$fn__25797$fn__25798.invoke (work_on_worktree_test.clj:279)
    mcp_tasks.test_helpers$with_test_setup_STAR_.invokeStatic (test_helpers.clj:100)
    mcp_tasks.test_helpers$with_test_setup_STAR_.invoke (test_helpers.clj:94)
    mcp_tasks.tool.work_on_worktree_test$fn__25797.invokeStatic (work_on_worktree_test.clj:249)
    mcp_tasks.tool.work_on_worktree_test/fn (work_on_worktree_test.clj:248)
    kaocha.type.var$test_var.invokeStatic (var.clj:24)
    kaocha.type.var$test_var.invoke (var.clj:20)
    kaocha.type.var$eval26927$fn__26929$wrapped_test__26932.invoke (var.clj:36)
    kaocha.plugin.capture_output$capture_output_pre_test_hook$fn__2257$fn__2258.invoke (capture_output.cljc:97)
    kaocha.type.var$eval26927$fn__26929.invoke (var.clj:38)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.type.ns$run_tests$fn__4432.invoke (ns.clj:21)
    ...
    kaocha.type.ns$run_tests.invokeStatic (ns.clj:21)
    kaocha.type.ns$run_tests.invoke (ns.clj:16)
    kaocha.type.ns$eval4450$fn__4451.invoke (ns.clj:61)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.test_suite$run.invokeStatic (test_suite.clj:7)
    kaocha.test_suite$run.invoke (test_suite.clj:5)
    kaocha.type.clojure.test$eval5861$fn__5862.invoke (test.clj:18)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.api$run$fn__4030$fn__4034$fn__4035.invoke (api.clj:159)
    ...
    kaocha.api$run$fn__4030$fn__4034.invoke (api.clj:133)
    ...
    kaocha.api$run$fn__4030.invoke (api.clj:132)
    ...
    kaocha.api$run.invokeStatic (api.clj:110)
    kaocha.api$run.invoke (api.clj:97)
    kaocha.runner$run$fn__4093.invoke (runner.clj:131)
    ...
    kaocha.runner$run.invokeStatic (runner.clj:129)
    kaocha.runner$run.invoke (runner.clj:72)
    kaocha.runner$_main_STAR_.invokeStatic (runner.clj:165)
    kaocha.runner$_main_STAR_.doInvoke (runner.clj:143)
    ...
    kaocha.runner$_main.invokeStatic (runner.clj:176)
    kaocha.runner$_main.doInvoke (runner.clj:174)
    ...

[31mFAIL[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-branch-discovery (work_on_worktree_test.clj:416)
work-on discovers existing worktree for branch handles branch in main repository working directory
Expected:
  [1;35m"/var/folders/pq/q3q7tfqd7x1g567w2xxy67x00000gn/T/mcp-tasks-test-10652785501467187251"[0m
Actual:
  [31m-"/var/folders/pq/q3q7tfqd7x1g567w2xxy67x00000gn/T/mcp-tasks-test-10652785501467187251"[0m [32m+nil[0m

[31mFAIL[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-branch-discovery (work_on_worktree_test.clj:417)
work-on discovers existing worktree for branch handles branch in main repository working directory
expected: (false? (:worktree-created? response))
  actual: (not (false? nil))

[31mFAIL[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-creates-worktree (work_on_worktree_test.clj:69)
work-on creates worktree on first execution
Expected:
  [1;35m"/var/folders/pq/q3q7tfqd7x1g567w2xxy67x00000gn/T/mcp-tasks-fix-parser-bug"[0m
Actual:
  [31m-"/var/folders/pq/q3q7tfqd7x1g567w2xxy67x00000gn/T/mcp-tasks-fix-parser-bug"[0m [32m+nil[0m

[31mFAIL[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-creates-worktree (work_on_worktree_test.clj:70)
work-on creates worktree on first execution
expected: (true? (:worktree-created? response))
  actual: (not (true? nil))

[31mFAIL[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-creates-worktree (work_on_worktree_test.clj:71)
work-on creates worktree on first execution
Expected:
  [1;35m"fix-parser-bug"[0m
Actual:
  [31m-"fix-parser-bug"[0m [32m+nil[0m

[31mERROR[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-creates-worktree (string.clj:377)
work-on creates worktree on first execution
Exception: java.lang.NullPointerException: Cannot invoke "Object.toString()" because "s" is null
 at clojure.string$includes_QMARK_.invokeStatic (string.clj:377)
    clojure.string$includes_QMARK_.invoke (string.clj:373)
    ...
    mcp_tasks.tool.work_on_worktree_test$fn__25551$fn__25552$fn__25597$fn__25614.invoke (work_on_worktree_test.clj:72)
    mcp_tasks.tool.work_on_worktree_test$fn__25551$fn__25552$fn__25597.invoke (work_on_worktree_test.clj:72)
    ...
    mcp_tasks.tool.work_on_worktree_test$fn__25551$fn__25552.invoke (work_on_worktree_test.clj:26)
    mcp_tasks.test_helpers$with_test_setup_STAR_.invokeStatic (test_helpers.clj:100)
    mcp_tasks.test_helpers$with_test_setup_STAR_.invoke (test_helpers.clj:94)
    mcp_tasks.tool.work_on_worktree_test$fn__25551.invokeStatic (work_on_worktree_test.clj:13)
    mcp_tasks.tool.work_on_worktree_test/fn (work_on_worktree_test.clj:12)
    kaocha.type.var$test_var.invokeStatic (var.clj:24)
    kaocha.type.var$test_var.invoke (var.clj:20)
    kaocha.type.var$eval26927$fn__26929$wrapped_test__26932.invoke (var.clj:36)
    kaocha.plugin.capture_output$capture_output_pre_test_hook$fn__2257$fn__2258.invoke (capture_output.cljc:97)
    kaocha.type.var$eval26927$fn__26929.invoke (var.clj:38)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.type.ns$run_tests$fn__4432.invoke (ns.clj:21)
    ...
    kaocha.type.ns$run_tests.invokeStatic (ns.clj:21)
    kaocha.type.ns$run_tests.invoke (ns.clj:16)
    kaocha.type.ns$eval4450$fn__4451.invoke (ns.clj:61)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.test_suite$run.invokeStatic (test_suite.clj:7)
    kaocha.test_suite$run.invoke (test_suite.clj:5)
    kaocha.type.clojure.test$eval5861$fn__5862.invoke (test.clj:18)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.api$run$fn__4030$fn__4034$fn__4035.invoke (api.clj:159)
    ...
    kaocha.api$run$fn__4030$fn__4034.invoke (api.clj:133)
    ...
    kaocha.api$run$fn__4030.invoke (api.clj:132)
    ...
    kaocha.api$run.invokeStatic (api.clj:110)
    kaocha.api$run.invoke (api.clj:97)
    kaocha.runner$run$fn__4093.invoke (runner.clj:131)
    ...
    kaocha.runner$run.invokeStatic (runner.clj:129)
    kaocha.runner$run.invoke (runner.clj:72)
    kaocha.runner$_main_STAR_.invokeStatic (runner.clj:165)
    kaocha.runner$_main_STAR_.doInvoke (runner.clj:143)
    ...
    kaocha.runner$_main.invokeStatic (runner.clj:176)
    kaocha.runner$_main.doInvoke (runner.clj:174)
    ...

[31mERROR[m in mcp-tasks.tool.work-on-worktree-test/work-on-worktree-creates-worktree (string.clj:377)
work-on creates worktree on first execution
Exception: java.lang.NullPointerException: Cannot invoke "Object.toString()" because "s" is null
 at clojure.string$includes_QMARK_.invokeStatic (string.clj:377)
    clojure.string$includes_QMARK_.invoke (string.clj:373)
    ...
    mcp_tasks.tool.work_on_worktree_test$fn__25551$fn__25552$fn__25597$fn__25618.invoke (work_on_worktree_test.clj:73)
    mcp_tasks.tool.work_on_worktree_test$fn__25551$fn__25552$fn__25597.invoke (work_on_worktree_test.clj:73)
    ...
    mcp_tasks.tool.work_on_worktree_test$fn__25551$fn__25552.invoke (work_on_worktree_test.clj:26)
    mcp_tasks.test_helpers$with_test_setup_STAR_.invokeStatic (test_helpers.clj:100)
    mcp_tasks.test_helpers$with_test_setup_STAR_.invoke (test_helpers.clj:94)
    mcp_tasks.tool.work_on_worktree_test$fn__25551.invokeStatic (work_on_worktree_test.clj:13)
    mcp_tasks.tool.work_on_worktree_test/fn (work_on_worktree_test.clj:12)
    kaocha.type.var$test_var.invokeStatic (var.clj:24)
    kaocha.type.var$test_var.invoke (var.clj:20)
    kaocha.type.var$eval26927$fn__26929$wrapped_test__26932.invoke (var.clj:36)
    kaocha.plugin.capture_output$capture_output_pre_test_hook$fn__2257$fn__2258.invoke (capture_output.cljc:97)
    kaocha.type.var$eval26927$fn__26929.invoke (var.clj:38)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.type.ns$run_tests$fn__4432.invoke (ns.clj:21)
    ...
    kaocha.type.ns$run_tests.invokeStatic (ns.clj:21)
    kaocha.type.ns$run_tests.invoke (ns.clj:16)
    kaocha.type.ns$eval4450$fn__4451.invoke (ns.clj:61)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.test_suite$run.invokeStatic (test_suite.clj:7)
    kaocha.test_suite$run.invoke (test_suite.clj:5)
    kaocha.type.clojure.test$eval5861$fn__5862.invoke (test.clj:18)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249$fn__2250.invoke (capture_output.cljc:88)
    ...
    kaocha.plugin.capture_output$capture_output_wrap_run_hook$fn__2249.doInvoke (capture_output.cljc:88)
    ...
    kaocha.testable$run.invokeStatic (testable.clj:129)
    kaocha.testable$run.invoke (testable.clj:120)
    kaocha.testable$run_testable.invokeStatic (testable.clj:211)
    kaocha.testable$run_testable.invoke (testable.clj:158)
    kaocha.testable$run_testables.invokeStatic (testable.clj:224)
    kaocha.testable$run_testables.invoke (testable.clj:214)
    kaocha.api$run$fn__4030$fn__4034$fn__4035.invoke (api.clj:159)
    ...
    kaocha.api$run$fn__4030$fn__4034.invoke (api.clj:133)
    ...
    kaocha.api$run$fn__4030.invoke (api.clj:132)
    ...
    kaocha.api$run.invokeStatic (api.clj:110)
    kaocha.api$run.invoke (api.clj:97)
    kaocha.runner$run$fn__4093.invoke (runner.clj:131)
    ...
    kaocha.runner$run.invokeStatic (runner.clj:129)
    kaocha.runner$run.invoke (runner.clj:72)
    kaocha.runner$_main_STAR_.invokeStatic (runner.clj:165)
    kaocha.runner$_main_STAR_.doInvoke (runner.clj:143)
    ...
    kaocha.runner$_main.invokeStatic (runner.clj:176)
    kaocha.runner$_main.doInvoke (runner.clj:174)
    ...
[31m304 tests, 2753 assertions, 3 errors, 15 failures.[m
